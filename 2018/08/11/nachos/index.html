<!DOCTYPE html><html lang="zh-tw"><head><meta charset="UTF-8"><meta name="author" content="Bingyu"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>nachos project notes</title><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/normalize/3.0.3/normalize.min.css"><link rel="stylesheet" type="text/css" href="/css/carbon.css"><script defer="defer" src="//cdn.jsdelivr.net/jquery/2.1.4/jquery.min.js"></script><script defer="defer" src="//cdn.jsdelivr.net/jquery.pjax/1.9.5/jquery.pjax.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.css" type="text/css" media="screen"><script defer="defer" type="text/javascript" src="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>var performFancybox = true;</script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/katex/0.5.0/katex.min.css"><script async="async" type="text/javascript" src="//cdn.jsdelivr.net/katex/0.5.0/katex.min.js"></script><script async="async" type="text/javascript" src="//cdn.jsdelivr.net/katex/0.5.0/contrib/auto-render.min.js"></script><script>var doRenderMath = 'katex';</script><script defer="defer" src="/js/carbon.js"></script><script>var trackID, domainID;
trackID = 'UA-110511310-4'; 
domainID = 'https://byshen.github.io'; 
(function(i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments);
        },
        i[r].l = 1 * new Date();
    a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.defer = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
})(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
ga('create', trackID, domainID);
ga('send', 'pageview');</script><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><div id="container"><div id="banner"><h1 id="site-title"><a href="/">西窗月</a></h1><p id="site-subtitle"></p></div><div id="content"><div class="meta"><h2 class="article-title"><a href="/2018/08/11/nachos">nachos project notes</a></h2><div class="article-date"><a href="javascript:void(0);" class="extra-switch">2018-08-11</a></div></div><div class="extra"><span class="Tags">Tags: <a href="/tags/nachos/">nachos</a>.</span></div><div class="extra"><span class="Categories">Categories: None.</span></div><div class="article-content"><div class="gallery"></div><h2 id="proj0"><a href="#proj0" class="headerlink" title="proj0"></a>proj0</h2><p>Just find and replace… It is better to read the code through though.</p>
<h2 id="proj1"><a href="#proj1" class="headerlink" title="proj1"></a>proj1</h2><h3 id="1-1"><a href="#1-1" class="headerlink" title="1.1"></a>1.1</h3><p>In <code>alarm.java</code>, make current thread wait for some interval. Just need an external structure to store the thread according to the priority. And in <code>timerInterrupt()</code> to wake them up if current time is larger than the designated time for each thread.</p>
<p>Note that the structure involves read and write at the same time, need to disable interrupt before handle it, or use some concurrent structure maybe.</p>
<h3 id="1-2"><a href="#1-2" class="headerlink" title="1.2"></a>1.2</h3><p>Need to has an external variable to record in which thread the join has been called. And a counter to record how many times has been called. But this is too cumbersome, since it involves atomicity. Maybe just test whether the join thread has been set or not.</p>
<h3 id="1-3"><a href="#1-3" class="headerlink" title="1.3"></a>1.3</h3><p><code>Condition.java</code> implements conditional variable (CV) using semaphores. Just open <code>Semaphore.java</code> and copy paste all the code into <code>Condition2.java</code>… Just kidding. Basicly, you do the samething. Use a simpler interrupt on a wait queue for threads trying to get the conditional variables. Think about that, when you <code>wait</code> (<code>sleep</code>) on some variables in one thread, need to put this thread into the wait queue. When others finished (call <code>wake</code>), then make this thread ready. Done.</p>
<p>Wait… Is that simple? What is the relationship with <code>lock</code>? Each CV has a lock. When <code>wait</code> (<code>sleep</code>) for some CV, you need first release the lock, let next thread <code>N</code> on the wait queue for the lock be ready. Then let the current thread <code>C</code> to sleep, put <code>C</code> on the wait queue for the conditional variable. Then let <code>N</code> acquire the lock, and do things.</p>
<p>It is a little complicated… Let’s think it fundementally. CV is a high level of synchronize primitive, which combines Lock with signal process. When you release the lock, you also <code>signal</code> others you are free. Put others on the wait queue for the lock to be ready. So when you wait for the conditional variables, you do not need to constantly check if the lock is free. Instead, you use a signal procedure to avoid this spinning waiting. Here is a helpful stack overflow link. <a href="https://stackoverflow.com/questions/1055398/differences-between-conditional-variables-mutexes-and-locks" target="_blank" rel="noopener">differences-between-conditional-variables-mutexes-and-locks</a></p>
<h3 id="1-4"><a href="#1-4" class="headerlink" title="1.4"></a>1.4</h3><p>Geoff’s homework is GameMatch, which is really geoff style. It does basicly the samething for locks and conditions. First <code>N-1</code> players are waiting, then the <code>N</code>th player comes to wake them all, and increase the match counter. The description is not so clear, so I assume it is first come, first serve order. However it is hard for testing if there are multiple rounds of matches.</p>
<h2 id="proj-2"><a href="#proj-2" class="headerlink" title="proj 2"></a>proj 2</h2><p>Since it involves <code>mips gcc</code> which can not run on my stupid macintosh, I switch to the ubuntu on my pc.</p>
<h3 id="2-1-file-system-calls"><a href="#2-1-file-system-calls" class="headerlink" title="2.1 file system calls"></a>2.1 file system calls</h3><p>Implement calls <code>creat</code>, <code>open</code>, <code>read</code>, <code>write</code>, <code>close</code>, and <code>unlink</code>, as specified in <code>test/syscall.h</code>.</p>
<p>Let’s do it step by step. Startring from the simple ones.</p>
<p>Personally I feel <code>open</code>, <code>close</code> are the simplest ones, from the length of description lol. You need to create a file descriptor table, to hold the <code>fd</code>. size is specified as 16. To read the file name, your need to call APIs, like <code>readVirtualMemoryString</code> in <code>UserProcess</code>.</p>
<p><code>read()</code>, <code>write</code> should consider many corner cases; like what if read failed, or read only 0 byte, which might be failure, or just no read. ?</p>
<p><code>unlink()</code>: let fs handle the problem of multiple open files</p>
<h3 id="support-multiprogramming"><a href="#support-multiprogramming" class="headerlink" title="support multiprogramming"></a>support multiprogramming</h3><p>questions:</p>
<ol>
<li>what should be done, if there is not enough page for the process? My current solution is to allocate pages one by one, if receives an error in the process, free all allocated pages for the process.</li>
<li></li>
</ol>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>[1] <a href="https://people.eecs.berkeley.edu/~kubitron/courses/cs162-F05/Nachos/index.html" target="_blank" rel="noopener">Nachos related document</a>. Especially <a href="https://people.eecs.berkeley.edu/~kubitron/courses/cs162-F05/Nachos/doc/index.html" target="_blank" rel="noopener">nachos javadoc</a> for walk through the APIs.</p>
</div><nav class="pagination"><a id="left-navigator" href="/2018/08/13/research-links/">Useful links for research</a><a id="right-navigator" href="/2018/08/10/paper-pres-note/">note on &quot;PRES - Probabilistic Replay with Execution Sketching on Multiprocessors&quot;</a></nav></div><nav id="footer"><ul id="footer-links"><li><a href="/about">About</a></li><li><a href="/archives">Archives</a></li><li><a href="/atom.xml">RSS</a></li><li><a href="https://github.com/byshen" class="out-site">GitHub</a></li><li><a href="https://github.com/hexojs/hexo" class="out-site">Hexo</a></li></ul></nav></div></body></html>