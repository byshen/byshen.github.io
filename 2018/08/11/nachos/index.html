<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />

    

    
    <title>nachos project notes | 西窗月</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content="nachos" />
    
    <meta name="description" content="proj0Just find and replace… It is better to read the code through though. proj11.1In alarm.java, make current thread wait for some interval. Just need an external structure to store the thread accordi">
<meta name="keywords" content="nachos">
<meta property="og:type" content="article">
<meta property="og:title" content="nachos project notes">
<meta property="og:url" content="https://byshen.github.io/2018/08/11/nachos/index.html">
<meta property="og:site_name" content="西窗月">
<meta property="og:description" content="proj0Just find and replace… It is better to read the code through though. proj11.1In alarm.java, make current thread wait for some interval. Just need an external structure to store the thread accordi">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2018-09-10T22:05:57.013Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="nachos project notes">
<meta name="twitter:description" content="proj0Just find and replace… It is better to read the code through though. proj11.1In alarm.java, make current thread wait for some interval. Just need an external structure to store the thread accordi">
    

    
        <link rel="alternate" href="/atom.xml" title="西窗月" type="application/atom+xml" />
    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/titillium-web/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/3.3.1/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    


<link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/">Home</a>
                                </li>
                            
                                        
                                    
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="https://byshen.github.io/wiki/">index.wiki</a>
                                </li>
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/about/index.html">About</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    uncategorized
    </h1>
</div>

                        <div class="main-body-content">
                            <article id="post-nachos" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        nachos project notes
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
        <a href="/2018/08/11/nachos/" class="article-date">
            <time datetime="2018-08-11T05:04:20.000Z" itemprop="datePublished">2018-08-11</time>
        </a>
    </div>

		

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/nachos/">nachos</a>
    </div>

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <h2 id="proj0"><a href="#proj0" class="headerlink" title="proj0"></a>proj0</h2><p>Just find and replace… It is better to read the code through though.</p>
<h2 id="proj1"><a href="#proj1" class="headerlink" title="proj1"></a>proj1</h2><h3 id="1-1"><a href="#1-1" class="headerlink" title="1.1"></a>1.1</h3><p>In <code>alarm.java</code>, make current thread wait for some interval. Just need an external structure to store the thread according to the priority. And in <code>timerInterrupt()</code> to wake them up if current time is larger than the designated time for each thread.</p>
<p>Note that the structure involves read and write at the same time, need to disable interrupt before handle it, or use some concurrent structure maybe.</p>
<h3 id="1-2"><a href="#1-2" class="headerlink" title="1.2"></a>1.2</h3><p>Need to has an external variable to record in which thread the join has been called. And a counter to record how many times has been called. But this is too cumbersome, since it involves atomicity. Maybe just test whether the join thread has been set or not.</p>
<h3 id="1-3"><a href="#1-3" class="headerlink" title="1.3"></a>1.3</h3><p><code>Condition.java</code> implements conditional variable (CV) using semaphores. Just open <code>Semaphore.java</code> and copy paste all the code into <code>Condition2.java</code>… Just kidding. Basicly, you do the samething. Use a simpler interrupt on a wait queue for threads trying to get the conditional variables. Think about that, when you <code>wait</code> (<code>sleep</code>) on some variables in one thread, need to put this thread into the wait queue. When others finished (call <code>wake</code>), then make this thread ready. Done.</p>
<p>Wait… Is that simple? What is the relationship with <code>lock</code>? Each CV has a lock. When <code>wait</code> (<code>sleep</code>) for some CV, you need first release the lock, let next thread <code>N</code> on the wait queue for the lock be ready. Then let the current thread <code>C</code> to sleep, put <code>C</code> on the wait queue for the conditional variable. Then let <code>N</code> acquire the lock, and do things.</p>
<p>It is a little complicated… Let’s think it fundementally. CV is a high level of synchronize primitive, which combines Lock with signal process. When you release the lock, you also <code>signal</code> others you are free. Put others on the wait queue for the lock to be ready. So when you wait for the conditional variables, you do not need to constantly check if the lock is free. Instead, you use a signal procedure to avoid this spinning waiting. Here is a helpful stack overflow link. <a href="https://stackoverflow.com/questions/1055398/differences-between-conditional-variables-mutexes-and-locks" target="_blank" rel="noopener">differences-between-conditional-variables-mutexes-and-locks</a></p>
<h3 id="1-4"><a href="#1-4" class="headerlink" title="1.4"></a>1.4</h3><p>Geoff’s homework is GameMatch, which is really geoff style. It does basicly the samething for locks and conditions. First <code>N-1</code> players are waiting, then the <code>N</code>th player comes to wake them all, and increase the match counter. The description is not so clear, so I assume it is first come, first serve order. However it is hard for testing if there are multiple rounds of matches.</p>
<h2 id="proj-2"><a href="#proj-2" class="headerlink" title="proj 2"></a>proj 2</h2><p>Since it involves <code>mips gcc</code> which can not run on my stupid macintosh, I switch to the ubuntu on my pc.</p>
<h3 id="2-1-file-system-calls"><a href="#2-1-file-system-calls" class="headerlink" title="2.1 file system calls"></a>2.1 file system calls</h3><p>Implement calls <code>creat</code>, <code>open</code>, <code>read</code>, <code>write</code>, <code>close</code>, and <code>unlink</code>, as specified in <code>test/syscall.h</code>.</p>
<p>Let’s do it step by step. Startring from the simple ones.</p>
<p>Personally I feel <code>open</code>, <code>close</code> are the simplest ones, from the length of description lol. You need to create a file descriptor table, to hold the <code>fd</code>. size is specified as 16. To read the file name, your need to call APIs, like <code>readVirtualMemoryString</code> in <code>UserProcess</code>.</p>
<p><code>read()</code>, <code>write</code> should consider many corner cases; like what if read failed, or read only 0 byte, which might be failure, or just no read. ?</p>
<p><code>unlink()</code>: let fs handle the problem of multiple open files</p>
<h3 id="support-multiprogramming"><a href="#support-multiprogramming" class="headerlink" title="support multiprogramming"></a>support multiprogramming</h3><p>questions:</p>
<ol>
<li>what should be done, if there is not enough page for the process? My current solution is to allocate pages one by one, if receives an error in the process, free all allocated pages for the process.</li>
<li></li>
</ol>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>[1] <a href="https://people.eecs.berkeley.edu/~kubitron/courses/cs162-F05/Nachos/index.html" target="_blank" rel="noopener">Nachos related document</a>. Especially <a href="https://people.eecs.berkeley.edu/~kubitron/courses/cs162-F05/Nachos/doc/index.html" target="_blank" rel="noopener">nachos javadoc</a> for walk through the APIs.</p>

        </div>
        <footer class="article-footer">
            



    <a data-url="https://byshen.github.io/2018/08/11/nachos/" data-id="cjtj4u42h0008ee8gdzsbce4w" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "author": {
            "@type": "Person",
            "name": "Bingyu"
        },
        "headline": "nachos project notes",
        "image": "https://byshen.github.io",
        "keywords": "nachos",
        "genre": "",
        "datePublished": "2018-08-11",
        "dateCreated": "2018-08-11",
        "dateModified": "2018-09-11",
        "url": "https://byshen.github.io/2018/08/11/nachos/",
        "description": "proj0Just find and replace… It is better to read the code through though.
proj11.1In alarm.java, make current thread wait for some interval. Just need an external structure to store the thread accordi"
        "wordCount": 640
    }
</script>

</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>



                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>follow:</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/byshen" target="_blank" rel="noopener">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="rss" href="/atom.xml" target="_blank" rel="noopener">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2018/08/13/research-links/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">newer</strong>
        <p class="article-nav-title">
        
            Wiki Links
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
        <a href="/2018/08/10/paper-pres-note/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">older</strong>
        <p class="article-nav-title">note on &#34;PRES&#34; paper</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

    
    <div class="widgets-container">
        
            
                

            
                
    <div class="widget-wrap">
        <h3 class="widget-title">recents</h3>
        <div class="widget">
            <ul id="recent-post" class="no-thumbnail">
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2019/03/06/how-to-write-a-paper/" class="title">How to write a paper?</a></p>
                            <p class="item-date"><time datetime="2019-03-06T15:12:35.000Z" itemprop="datePublished">2019-03-06</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2019/01/27/unplug-learning/" class="title">不插电学习法</a></p>
                            <p class="item-date"><time datetime="2019-01-27T11:22:31.000Z" itemprop="datePublished">2019-01-27</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/11/25/union-find/" class="title">Disjoint-set (union find)</a></p>
                            <p class="item-date"><time datetime="2018-11-25T03:50:03.000Z" itemprop="datePublished">2018-11-25</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/08/27/characteristic-study/" class="title">Characteristic study</a></p>
                            <p class="item-date"><time datetime="2018-08-27T03:10:29.000Z" itemprop="datePublished">2018-08-27</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/08/22/paper-learn-from-mistakes/" class="title">Notes on &#34;learn from mistakes&#34;</a></p>
                            <p class="item-date"><time datetime="2018-08-22T07:40:23.000Z" itemprop="datePublished">2018-08-22</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">2</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">tags</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithm/">algorithm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asplos08/">asplos08</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bug/">bug</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/characteristic-study/">characteristic study</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/concurrency-bug/">concurrency bug</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leetcode/">leetcode</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lessons/">lessons</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/links/">links</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nachos/">nachos</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/paper/">paper</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reproduce/">reproduce</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/research/">research</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sosp09/">sosp09</a><span class="tag-list-count">1</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-float">
        <h3 class="widget-title">tag cloud</h3>
        <div class="widget tagcloud">
            <a href="/tags/algorithm/" style="font-size: 10px;">algorithm</a> <a href="/tags/android/" style="font-size: 10px;">android</a> <a href="/tags/asplos08/" style="font-size: 10px;">asplos08</a> <a href="/tags/blog/" style="font-size: 10px;">blog</a> <a href="/tags/bug/" style="font-size: 10px;">bug</a> <a href="/tags/characteristic-study/" style="font-size: 10px;">characteristic study</a> <a href="/tags/concurrency-bug/" style="font-size: 10px;">concurrency bug</a> <a href="/tags/leetcode/" style="font-size: 13.33px;">leetcode</a> <a href="/tags/lessons/" style="font-size: 10px;">lessons</a> <a href="/tags/links/" style="font-size: 10px;">links</a> <a href="/tags/nachos/" style="font-size: 10px;">nachos</a> <a href="/tags/paper/" style="font-size: 16.67px;">paper</a> <a href="/tags/reproduce/" style="font-size: 10px;">reproduce</a> <a href="/tags/research/" style="font-size: 20px;">research</a> <a href="/tags/sosp09/" style="font-size: 10px;">sosp09</a>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>

                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2019 Bingyu</p>
                <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p>
            </div>
            <div class="footer-plugins">
              
    


            </div>
        </div>
    </div>
</footer>

        
    
    <script>
    var disqus_shortname = 'sbygithub';
    
    
    var disqus_url = 'https://byshen.github.io/2018/08/11/nachos/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>
